# Makefile to build CVs
# Usage:
#  make short   -> build short CV PDF
#  make long    -> build long CV PDF
#  make all     -> build both
#  make clean   -> remove generated files


LATEXMK = latexmk
# Use LuaLaTeX so the TeX files can execute Lua to read JSON at compile time
PDFLATEX = lualatex -interaction=nonstopmode

# CV choice: use make CV=short or make CV=long; default is long
CV ?= long
CV_FILE = MbalireShawalCV_$(CV).tex
WRAP = MbalireShawalCV.tex

.PHONY: build short long all clean wrapper

# Build the chosen CV by default
build:
	@echo "Building $(CV_FILE)..."
	cd $(shell pwd) && $(LATEXMK) -pdf -pdflatex="$(PDFLATEX)" $(CV_FILE)

short:
	$(MAKE) CV=short build

long:
	$(MAKE) CV=long build

all:
	$(MAKE) CV=short build
	$(MAKE) CV=long build

wrapper:
	@echo "Generating wrapper $(WRAP) to input $(CV_FILE)"
	@printf '%s\n' "% Modular wrapper generated by Makefile" "\\documentclass[a4paper,10pt]{article}" "\\usepackage[a4paper,margin=0.75in]{geometry}" "\\usepackage{enumitem}" "\\usepackage{titlesec}" "\\usepackage{parskip}" "\\usepackage[hidelinks]{hyperref}" "" "\\titlespacing*{\\section}{0pt}{2ex}{1ex}" "\\titlespacing*{\\subsection}{0pt}{1ex}{1ex}" "" "\\begin{document}" "\\parindent=0pt" "" "\\input{$(CV_FILE)}" "" "\\end{document}" > $(WRAP)

clean:
	cd $(shell pwd) && $(LATEXMK) -C || true
